:original_name: dws_04_0270.html

.. _dws_04_0270:

Overview
========

GaussDB(DWS) provides gs_dump and gs_dumpall to export required database objects and related information. To migrate database information, you can use a tool to import the exported metadata to a target database. gs_dump exports a single database or its objects. gs_dumpall exports all databases or global objects in a cluster. For details, see :ref:`Table 1 <en-us_topic_0000001811610329__en-us_topic_0000001233883377_en-us_topic_0000001098815008_table08278213504>`.

.. _en-us_topic_0000001811610329__en-us_topic_0000001233883377_en-us_topic_0000001098815008_table08278213504:

.. table:: **Table 1** Application scenarios

   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | Application Scenario                 | Export Granularity                                                                                                                                                  | Export Format   | Import Method                                                                                                                                 |
   +======================================+=====================================================================================================================================================================+=================+===============================================================================================================================================+
   | Exporting a single database          | :ref:`Database-level export <dws_04_0272>`                                                                                                                          | -  Plain text   | -  For details about how to import data files in text format, see :ref:`Using a gsql Meta-Command to Import Data <dws_04_0208>`.              |
   |                                      |                                                                                                                                                                     | -  Custom       | -  For details about how to import data files in .tar, directory, or custom format, see :ref:`Using gs_restore to Import Data <dws_04_0209>`. |
   |                                      | -  Export full information of a database.                                                                                                                           | -  Directory    |                                                                                                                                               |
   |                                      |                                                                                                                                                                     | -  .tar         |                                                                                                                                               |
   |                                      |    You can use the exported information to create a same database containing the same data as the current one.                                                      |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export all object definitions of a database, including the definitions of the database, functions, schemas, tables, indexes, and stored procedures.              |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      |    You can use the exported object definitions to quickly create a same database as the current one, without data.                                                  |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export data of a database.                                                                                                                                       |                 |                                                                                                                                               |
   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   |                                      | :ref:`Schema-level export <dws_04_0273>`                                                                                                                            |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export full information of a schema.                                                                                                                             |                 |                                                                                                                                               |
   |                                      | -  Export data of a schema.                                                                                                                                         |                 |                                                                                                                                               |
   |                                      | -  Export all object definitions of a schema, including the definitions of tables, stored procedures, and indexes.                                                  |                 |                                                                                                                                               |
   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   |                                      | :ref:`Table-level export <dws_04_0274>`                                                                                                                             |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export full information of a table.                                                                                                                              |                 |                                                                                                                                               |
   |                                      | -  Export data of a table.                                                                                                                                          |                 |                                                                                                                                               |
   |                                      | -  Export the definition of a table.                                                                                                                                |                 |                                                                                                                                               |
   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | Exporting all databases in a cluster | :ref:`Database-level export <dws_04_0276>`                                                                                                                          | Plain text      | For details about how to import data files, see :ref:`Using a gsql Meta-Command to Import Data <dws_04_0208>`.                                |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export full information of a cluster.                                                                                                                            |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      |    You can use the exported information to create a same cluster containing the same databases, global objects, and data as the current one.                        |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export all object definitions of a cluster, including the definitions of tablespaces, databases, functions, schemas, tables, indexes, and stored procedures.     |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      |    You can use the exported object definitions to quickly create a same cluster as the current one, containing the same databases and tablespaces but without data. |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export data of a cluster.                                                                                                                                        |                 |                                                                                                                                               |
   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   |                                      | :ref:`Global object export <dws_04_0277>`                                                                                                                           |                 |                                                                                                                                               |
   |                                      |                                                                                                                                                                     |                 |                                                                                                                                               |
   |                                      | -  Export tablespaces.                                                                                                                                              |                 |                                                                                                                                               |
   |                                      | -  Export roles.                                                                                                                                                    |                 |                                                                                                                                               |
   |                                      | -  Export tablespaces and roles.                                                                                                                                    |                 |                                                                                                                                               |
   +--------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------+-----------------------------------------------------------------------------------------------------------------------------------------------+

gs_dump and gs_dumpall use **-U** to specify the user that performs the export. If the specified user does not have the required permission, data cannot be exported. In this case, you can set **--role** in the export command to the role that has the permission. Then, gs_dump or gs_dumpall uses the specified role to export data. See :ref:`Table 1 <en-us_topic_0000001811610329__en-us_topic_0000001233883377_en-us_topic_0000001098815008_table08278213504>` for application scenarios and :ref:`Data Export By a User Without Required Permissions <en-us_topic_0000001764491960>` for operation details.

gs_dump and gs_dumpall encrypt the exported data files. These files are decrypted before being imported to prevent data disclosure for higher database security.

When gs_dump and gs_dumpall are used to export data, the exported tables are locked, which blocks read and write operations.

gs_dump and gs_dumpall can export complete, consistent data. For example, if gs_dump is used to export database A or gs_dumpall is used to export all databases from a cluster at T1, data of database A or all databases in the cluster at that time point will be exported, and modifications on the databases after that time point will not be exported.

Obtain gs_dump and gs_dumpall by decompressing the **gsql CLI client** package.

Precautions
-----------

-  Do not modify an exported file or its content. Otherwise, restoration may fail.
-  For data consistency and integrity, gs_dump and gs_dumpall set a share lock for a table to be dumped. If a share lock has been set for the table in other transactions, gs_dump and gs_dumpall lock the table after the lock is released. If the table cannot be locked within the specified time, the dump fails. You can customize the timeout duration to wait for lock release by specifying the **--lock-wait-timeout** parameter.
-  During an export, gs_dumpall reads all tables in a database. Therefore, you need to connect to the database as a cluster administrator to export a complete file. When you use gsql to import scripts, cluster administrator permissions are also required to add users and user groups, and create databases.
-  By default, the definitions of all views in the GaussDB(DWS) database contain the prefix of table names or aliases (in **tab.col** format). Therefore, the definitions may be inconsistent with the original ones. As a result, the base table corresponding to the rebuilt view column is incorrect and an error is reported. However, this rarely happens. To prevent this problem, you are advised to set the GUC parameter **behavior_compat_options** to **compat_display_ref_table** when exporting view definitions, so the exported definitions are consistent with the original statements.
